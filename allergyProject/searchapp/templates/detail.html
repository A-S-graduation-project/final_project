{% extends 'base.html' %}
{% load static %}
{% block content %}

<h1>Search results for "{{ detail.prdlstNm }}"</h1>
<main>
  <div class="food-details">
      <!-- <img src="{% static 'food-image.jpg' %}" alt="Food Image"> -->
      <img src="{{ detail.image }}" alt="Food Image">
      <div class="food-info">
        <h2>Food Name</h2>
        <p>Description information about the food.</p>
        <form action="https://search.shopping.naver.com/search/all" method="GET">
            <input type="hidden" name="query" value="{{ detail.name }}">
            <button class="buy" type="submit"> 구매하기 </button>
        </form>
        <form action="{% url 'searchapp:like_button' %}" method="POST" class="like-form">
          {% csrf_token %}
          <input type="hidden" name="title" value="{{ detail.prdlstNm }}">
          <input type="hidden" name="fno" value="{{ detail.prdlstReportNo }}">
          <input type="hidden" name="pk" value="{{ detail.pk }}"> 
          <button type="submit" class="like-button {% if user_liked_product %}liked{% endif %}" aria-label="좋아요"></button>
        </form>
      </div>
  </div>
</main>
<div id="recommend"></div>
<div class="picture-grid">
  {% for collarbor in collarbors %}
    <div class="picture">
      <a href="{% url 'searchapp:Detail' %}?pk={{ collarbor.prdlstReportNo }}">
        <img src="{{ collarbor.image }}" alt="{{ collarbor.prdlstNm }}">
        <p>{{ collarbor.prdlstNm }}</p>
      </a>
    </div>
    {% empty %}
      <h4>결과 없음</h4>
  {% endfor %}
</div>

<div class="picture-grid">
  {% for similarity in similarities %}
    <div class="picture">
      <a href="{% url 'searchapp:Detail' %}?pk={{ similarity.prdlstReportNo }}">
        <img src="{{ similarity.image }}" alt="{{ similarity.prdlstNm }}">
        <p>{{ similarity.prdlstNm }}</p>
      </a>
    </div>
    {% empty %}
      <h4>결과 없음</h4>
  {% endfor %}
</div>
<script>
  $(document).ready(function() {
    var $submitButton = $('.like-button');
    
    // 페이지 로드 시 버튼 클래스를 확인하여 초기 색상 설정
    if ($submitButton.hasClass('liked')) {
      $submitButton.css('background-color', '#ff5733'); // 북마크 추가 상태의 배경색
    } else {
      $submitButton.css('background-color', '#ccc'); // 기본 상태의 배경색
    }

    $('.like-form').submit(function(event) {
      event.preventDefault(); // 기본 폼 제출 동작을 막습니다.
      
      $.ajax({
        type: 'POST',
        url: $(this).attr('action'),
        data: new FormData(this),
        processData: false,
        contentType: false,
        success: function(data) {
          // '좋아요'가 성공적으로 처리되면 'liked' 클래스를 토글합니다.
          $submitButton.toggleClass('liked');
          
          // 'liked' 클래스가 있는 경우 (북마크 추가) 버튼의 배경색을 설정합니다.
          if ($submitButton.hasClass('liked')) {
            $submitButton.css('background-color', '#ff5733'); // '좋아요' 상태의 배경색
          } else {
            $submitButton.css('background-color', '#ccc'); // 기본 상태의 배경색
          }
        },
        error: function() {
          // 오류 처리 (필요한 경우)
        }
      });
    });
  });
</script>
{% endblock %}
