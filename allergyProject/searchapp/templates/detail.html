{% extends 'base.html' %}
{% load static %}
{% block content %}

<h1>Search results for "{{ detail.prdlstNm }}"</h1>
<main>
  <div class="food-details">
      <!-- <img src="{% static 'food-image.jpg' %}" alt="Food Image"> -->
      <img src="{{ detail.image }}" alt="Food Image">
      <div class="food-info">
        <h2>Food Name</h2>
        <p>Description information about the food.</p>
        <form action="https://search.shopping.naver.com/search/all" method="GET">
            <input type="hidden" name="query" value="{{ detail.name }}">
            <button class="buy" type="submit"> 구매하기 </button>
        </form>
        <form action="{% url 'searchapp:like_button' %}" method="POST" class="like-form">
          {% csrf_token %}
          <input type="hidden" name="title" value="{{ detail.prdlstNm }}">
          <input type="hidden" name="fno" value="{{ detail.prdlstReportNo }}">
          <input type="hidden" name="pk" value="{{ detail.pk }}"> 
          <button type="submit" class="like-button {% if user_liked_product %}liked{% endif %}" aria-label="좋아요"></button>
        </form>
        {% if messages %}
        <div id="messages">
          {% for message in messages %}
          <div class="message">{{ message }}</div>
          {% endfor %}
        </div>
        {% endif %}
      </div>
  </div>
</main>
<div id="recommend"></div>
<div class="picture-grid">
  {% if user.is_authenticated %}
    {% for collarbor in collarbors %}
      <div class="picture">
        <a href="{% url 'searchapp:Detail' %}?pk={{ collarbor.prdlstReportNo }}">
          <img src="{{ collarbor.image }}" alt="{{ collarbor.prdlstNm }}">
          <p>{{ collarbor.prdlstNm }}</p>
        </a>
      </div>
      {% empty %}
        <h4>결과 없음</h4>
    {% endfor %}
  {% else %}
      <h2>로그인 필요</h2>
  {% endif %}
</div>

<div class="picture-grid">
  {% for similarity in similarities %}
    <div class="picture">
      <a href="{% url 'searchapp:Detail' %}?pk={{ similarity.prdlstReportNo }}">
        <img src="{{ similarity.image }}" alt="{{ similarity.prdlstNm }}">
        <p>{{ similarity.prdlstNm }}</p>
      </a>
    </div>
    {% empty %}
      <h4>결과 없음</h4>
  {% endfor %}
</div>
<script>
  $(document).ready(function() {
    var $submitButton = $('.like-button');

    $('.like-form').submit(function(event) {
      event.preventDefault();

      var formData = new FormData(this);

      $.ajax({
        type: 'POST',
        url: $(this).attr('action'),
        data: formData,
        processData: false,
        contentType: false,
      });
    });
  });
</script>
{% endblock %}
